<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Haiyu.Pages.Communitys.GamerExploreIndexPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Worldwrapper="using:Haiyu.Models.Wrapper.CommunityWorld"
    xmlns:cui="using:CommunityToolkit.WinUI"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:local="using:Haiyu.Pages.Communitys"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:model="using:Waves.Api.Models.Communitys.DataCenter"
    xmlns:ui="using:Haiyu.Controls"
    xmlns:wrapper="using:Haiyu.Models.Wrapper"
    xmlns:wui="using:CommunityToolkit.WinUI.Controls"
    mc:Ignorable="d">
    <Page.Resources />
    <i:Interaction.Behaviors>
        <i:EventTriggerBehavior EventName="Loaded">
            <i:InvokeCommandAction Command="{x:Bind ViewModel.LoadedCommand}" />
        </i:EventTriggerBehavior>
    </i:Interaction.Behaviors>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <ComboBox
            Margin="0,-40,0,0"
            HorizontalAlignment="Right"
            ItemsSource="{x:Bind ViewModel.Countrys, Mode=OneWay}"
            SelectedItem="{x:Bind ViewModel.SelectCountry, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
            <ComboBox.ItemTemplate>
                <DataTemplate x:DataType="Worldwrapper:ExploreIndexCountry">
                    <StackPanel Orientation="Horizontal">
                        <ui:ImageEx
                            Width="25"
                            Height="25"
                            Source="{x:Bind Icon}" />
                        <TextBlock
                            Margin="5,0,0,0"
                            VerticalAlignment="Center"
                            Text="{x:Bind DisplayName}" />
                    </StackPanel>
                </DataTemplate>
            </ComboBox.ItemTemplate>
        </ComboBox>
        <ScrollView
            Grid.Row="1"
            HorizontalScrollBarVisibility="Hidden"
            VerticalScrollBarVisibility="Hidden">
            <ItemsRepeater ItemsSource="{x:Bind ViewModel.CountrysItems, Mode=OneWay}">
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate x:DataType="wrapper:DataCenterExploreCountryItem">
                        <Grid
                            Margin="5"
                            cui:Effects.Shadow="{StaticResource CardShadow}"
                            CornerRadius="5">

                            <ui:ImageEx
                                Opacity="1"
                                Source="{x:Bind AreaPic}"
                                Stretch="UniformToFill" />
                            <StackPanel
                                Padding="10,10,10,10"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Bottom"
                                Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}"
                                CornerRadius="0 5 0 0"
                                Orientation="Vertical">
                                <TextBlock FontFamily="{ThemeResource DefaultFont}">
                                    <Run FontSize="20" Text="{x:Bind Progress}" />
                                    <Run Text="%" />
                                </TextBlock>
                                <TextBlock FontFamily="{ThemeResource DefaultFont}" Text="{x:Bind DisplayName}" />
                            </StackPanel>
                            <ProgressBar
                                VerticalAlignment="Bottom"
                                Foreground="{ThemeResource SystemFillColorSuccessBrush}"
                                Value="{x:Bind Progress}" />
                            <Button
                                Margin="10"
                                Padding="5"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                CornerRadius="5"
                                Style="{ThemeResource DefaultAcrylicButtonStyle}">
                                <FontIcon
                                    FontFamily="Segoe Fluent Icons"
                                    FontSize="18"
                                    Glyph="&#xE76C;" />
                                <Button.Flyout>
                                    <Flyout Placement="Right" ShouldConstrainToRootBounds="False">
                                        <ScrollView Width="200" Height="200">
                                            <ItemsRepeater Width="200" ItemsSource="{x:Bind Items}">
                                                <ItemsRepeater.ItemTemplate>
                                                    <DataTemplate x:DataType="model:ItemList">
                                                        <Grid
                                                            Margin="5"
                                                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                            BorderThickness="2"
                                                            CornerRadius="4">
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition />
                                                                <RowDefinition Height="auto" />
                                                            </Grid.RowDefinitions>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="auto" />
                                                                <ColumnDefinition />
                                                            </Grid.ColumnDefinitions>
                                                            <ui:ImageEx
                                                                Grid.RowSpan="2"
                                                                Width="20"
                                                                Height="20"
                                                                Margin="5,5,0,5"
                                                                Source="{x:Bind Icon}"
                                                                Stretch="UniformToFill" />
                                                            <ProgressBar
                                                                Grid.Row="1"
                                                                Grid.Column="0"
                                                                Grid.ColumnSpan="2"
                                                                Margin="0,5,0,0"
                                                                VerticalAlignment="Bottom"
                                                                Background="Transparent"
                                                                Foreground="{ThemeResource SystemFillColorSuccessBrush}"
                                                                Maximum="100"
                                                                Value="{x:Bind Progress}" />
                                                            <TextBlock
                                                                Grid.Row="0"
                                                                Grid.Column="1"
                                                                Margin="5,5,0,0"
                                                                VerticalAlignment="Center"
                                                                Text="{x:Bind Name}"
                                                                TextTrimming="CharacterEllipsis" />
                                                            <TextBlock
                                                                Grid.RowSpan="2"
                                                                Grid.Column="1"
                                                                Margin="0,0,5,0"
                                                                HorizontalAlignment="Right"
                                                                VerticalAlignment="Center">
                                                                <Run Text="{x:Bind Progress}" />
                                                                <Run Text="%" />
                                                            </TextBlock>
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsRepeater.ItemTemplate>
                                                <ItemsRepeater.Layout>
                                                    <StackLayout Orientation="Vertical" />
                                                </ItemsRepeater.Layout>
                                            </ItemsRepeater>
                                        </ScrollView>
                                    </Flyout>
                                </Button.Flyout>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
                <ItemsRepeater.Layout>
                    <UniformGridLayout
                        ItemsJustification="Start"
                        ItemsStretch="Uniform"
                        MinColumnSpacing="2"
                        MinItemHeight="130"
                        MinItemWidth="200"
                        MinRowSpacing="2" />
                </ItemsRepeater.Layout>
            </ItemsRepeater>
        </ScrollView>

    </Grid>
</Page>
